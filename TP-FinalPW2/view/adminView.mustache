<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Estadísticas del Juego</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<style>
    body{
        min-height: 100vh;
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
    }
    h1 {
        color: #ff6f20;
    }
    a.password-link {
        color: #0000ee;
        display: block;
        margin: 10px 0;
    }
</style>
<body class="bg-light">

<div class="container py-4">
    <div class="d-flex justify-content-end align-items-start mb-3">
        <a class="btn-darkblue btn-rounded" href="/login/logout" style="text-decoration: none">Cerrar Sesión</a>
    </div>
    <div class="d-flex justify-content-center align-items-start mb-3">
        <h1>PREGUNTASTICO</h1>
    </div>

    <h2 class="mb-4 text-center">Estadísticas del Juego</h2>

    <div class="mb-4 text-center">
        <label for="filtro" class="form-label fw-bold">Filtrar por:</label>
        <select id="filtro" class="form-select w-auto d-inline-block">
            <option value="dia">Día</option>
            <option value="semana">Semana</option>
            <option value="mes">Mes</option>
            <option value="anio">Año</option>
        </select>
    </div>

    <div class="row text-center mb-4">
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Jugadores</h5>
                    <p class="card-text fs-4 fw-semibold">{{jugadores}}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Partidas Jugadas</h5>
                    <p class="card-text fs-4 fw-semibold">{{partidas}}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Preguntas Totales</h5>
                    <p class="card-text fs-4 fw-semibold">{{preguntas_totales}}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row text-center mb-4">
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Preguntas Creadas</h5>
                    <p class="card-text fs-4 fw-semibold">{{preguntas_creadas}}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Usuarios Nuevos</h5>
                    <p class="card-text fs-4 fw-semibold">{{usuarios_nuevos}}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mt-2">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-center">Porcentaje de Respuestas Correctas</h5>
                    <canvas id="respuestasCorrectas"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-center">Usuarios por País</h5>
                    <canvas id="usuariosPorPais"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-center">Usuarios por Sexo</h5>
                    <canvas id="usuariosPorSexo"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-center">Usuarios por Edad</h5>
                    <canvas id="usuariosPorEdad"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Los siguientes bloques serán reemplazados dinámicamente por Mustache
    const respuestasData = {{#respuestas_por_usuario}} {
        labels: {{labels}},
        datasets: [{
            label: '% Correctas',
            data: {{data}},
            backgroundColor: 'rgba(75, 192, 192, 0.6)'
        }]
    } {{/respuestas_por_usuario}};

    const paisData = {{#usuarios_por_pais}} {
        labels: {{labels}},
        datasets: [{
            label: 'Usuarios',
            data: {{data}},
            backgroundColor: 'rgba(153, 102, 255, 0.6)'
        }]
    } {{/usuarios_por_pais}};

    const sexoData = {{#usuarios_por_sexo}} {
        labels: {{labels}},
        datasets: [{
            label: 'Usuarios',
            data: {{data}},
            backgroundColor: ['#FF6384', '#36A2EB']
        }]
    } {{/usuarios_por_sexo}};

    const edadData = {{#usuarios_por_edad}} {
        labels: {{labels}},
        datasets: [{
            label: 'Usuarios',
            data: {{data}},
            backgroundColor: ['#FFCE56', '#4BC0C0', '#9966FF']
        }]
    } {{/usuarios_por_edad}};

    new Chart(document.getElementById('respuestasCorrectas'), {
        type: 'bar',
        data: respuestasData
    });

    new Chart(document.getElementById('usuariosPorPais'), {
        type: 'pie',
        data: paisData
    });

    new Chart(document.getElementById('usuariosPorSexo'), {
        type: 'doughnut',
        data: sexoData
    });

    new Chart(document.getElementById('usuariosPorEdad'), {
        type: 'bar',
        data: edadData
    });

    // Filtrado por fecha
    document.getElementById('filtro').addEventListener('change', function () {
        const filtro = this.value;
        window.location.href = '?filtro=' + filtro;
    });
</script>
</body>
</html>